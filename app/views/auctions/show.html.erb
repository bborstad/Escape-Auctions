<%= render "layouts/navbar" %>

<div class="card mb-3" style="width: 18rem;">

  <h3 class="card-header"></h3>

  <div class="card-body">
    <h5 class="card-title"><%= auction.title%></h5>
    <h6 class="card-subtitle text-muted"> Created by: <%= auction.user.username %></h6>
  </div>

  <%= image_tag(auction.image, style:'height: 200px; width: 100%; display: block;') %>

  <div class="card-body">
    <p class="card-text"><%= auction.description%></p>
  </div>

  <% winning_bid =  auction.bids.order(amount: :desc).first %>
  <% if winning_bid.present? %>
    <% winning_bid_amount = winning_bid.amount %>
  <% else %>
    <% winning_bid_amount = auction.starting_bid %>
  <% end %>
  <% if auction.is_expired? == false %>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">Expire Date: <%= auction.expire_date %></li>
      <li class="list-group-item">Starting Bid: $<%= auction.starting_bid %></li>

      <li class="list-group-item">Current Bid: $<%= winning_bid_amount %></li>

      <li class="list-group-item">Buy Now Price: $<%= auction.buy_now_price %></li>
      <a class="btn btn-primary" href="/purchased/<%= auction.id %>">Buy Now</a>
      <li class="list-group-item">Auction Status: active</li>
    </ul>
      <div class="card-body">
        <%= form_with url: "/auctions/#{auction.id}/bid", method: :post do |f| %>
          <%= f.number_field :amount, :value => (winning_bid_amount + 1)%>
          <%= f.submit "Place bid" %>
        <% end %>  
      </div>
  <% else %>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">Expire Date: <%= auction.expire_date %></li>

      <li class="list-group-item">Current Bid: $<%= winning_bid_amount %></li>

      <li class="list-group-item">Auction Status: inactive</li>
  <% end %>

  <p><%= link_to 'Add Review', "/auctions/#{auction.id}/reviews/new" %></p>

  <p>Tags:</p>
  <p>
    <% auction.tag_list.each do |tag| %>
     <%= tag %>,
    <% end %>
  </p>
</div>
